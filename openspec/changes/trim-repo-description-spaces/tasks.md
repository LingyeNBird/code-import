# 任务列表

## 实现阶段

### 1. 修改仓库创建函数添加空格修剪逻辑
- **文件**: `pkg/api/target/api.go`
- **函数**: `CreateRepo`
- **操作**: 在创建请求体之前,使用 `strings.TrimSpace(repoDesc)` 修剪描述
- **验证**: 确保修剪后的描述长度仍然符合 `RepoDescLimitSize` 限制
- **预期结果**: 描述字段前后空格被移除

### 2. 编写单元测试验证修剪行为
- **文件**: `pkg/api/target/api_test.go`(新建或更新)
- **测试场景**:
  - 描述前有空格: `"  测试描述"` → `"测试描述"`
  - 描述后有空格: `"测试描述  "` → `"测试描述"`
  - 描述前后都有空格: `"  测试描述  "` → `"测试描述"`
  - 描述中间有空格: `"测试 描述"` → `"测试 描述"`(保持不变)
  - 空描述: `""` → `""`
  - 仅空格: `"   "` → `""`
  - 超长描述带空格: 修剪后再截断
- **预期结果**: 所有测试通过

### 3. 审查和更新相关测试用例
- **文件**: `pkg/migrate/migrate_test.go`、各平台 VCS 测试文件
- **操作**: 检查是否有测试假设描述包含前后空格
- **预期结果**: 无测试回归

### 4. 更新规范文档
- **文件**: `openspec/changes/trim-repo-description-spaces/specs/data-sanitization/spec.md`
- **操作**: 创建新的数据清理规范或更新现有规范
- **内容**: 记录仓库描述的空格修剪行为和场景
- **预期结果**: 规范清晰描述了修剪逻辑

### 5. 运行完整测试套件
- **命令**: `go test -v ./pkg/api/target/`
- **命令**: `go test -v ./pkg/migrate/`
- **预期结果**: 所有测试通过,无回归

### 6. 手动验证端到端场景
- **操作**: 使用带有前后空格描述的测试仓库运行迁移
- **预期结果**: 仓库成功创建,描述正确显示(无前后空格)

## 验证阶段

### 7. 运行 OpenSpec 验证
- **命令**: `openspec validate trim-repo-description-spaces --strict`
- **预期结果**: 无验证错误

### 8. 代码格式化和静态分析
- **命令**: `gofmt -w pkg/api/target/api.go`
- **命令**: `goimports -w pkg/api/target/api.go`
- **命令**: `go vet ./pkg/api/target/`
- **预期结果**: 代码符合项目规范

## 依赖关系

- 任务 2 依赖任务 1(需要先实现功能再测试)
- 任务 3 依赖任务 1(需要了解变更内容)
- 任务 4 可与任务 1-3 并行进行
- 任务 5 依赖任务 1-3(所有代码变更完成后)
- 任务 6 依赖任务 5(测试通过后)
- 任务 7-8 依赖所有前序任务

## 预估工作量

- **实现**: 30分钟
- **测试**: 1小时
- **文档**: 30分钟
- **验证**: 30分钟
- **总计**: 约 2.5小时
